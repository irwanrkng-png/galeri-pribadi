<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Kelola Galeri</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #1a1a1a;
            --secondary-color: #2d2d2d;
            --danger: #dc3545;
            --success: #28a745;
            --bg-light: #0f0f0f;
            --text-dark: #e0e0e0;
            --text-light: #a0a0a0;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.4);
            --accent: #4a9eff;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 100%);
            color: var(--text-dark);
        }

        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--accent);
        }

        .admin-header h1 {
            font-size: 2rem;
            color: var(--accent);
        }

        .logout-btn {
            background-color: var(--danger);
            color: white;
            padding: 0.8rem 2rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        .logout-btn:hover {
            background-color: #c0392b;
        }

        .auth-container {
            background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
            padding: 2rem;
            border-radius: 10px;
            max-width: 400px;
            margin: 3rem auto;
            box-shadow: var(--shadow);
            text-align: center;
            border-left: 4px solid var(--accent);
        }

        .auth-container h2 {
            margin-bottom: 1.5rem;
            color: var(--accent);
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #3a3a3a;
            border-radius: 5px;
            font-family: inherit;
            font-size: 1rem;
            background-color: #1a1a1a;
            color: var(--text-dark);
        }

        .form-group textarea {
            resize: vertical;
        }

        .btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            pointer-events: auto;
            z-index: 10;
        }

        .btn-primary {
            background-color: var(--accent);
            color: white;
        }

        .btn-primary:hover {
            background-color: #3385d6;
        }

        .btn-primary:active {
            transform: scale(0.98);
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        .btn-success {
            background-color: var(--success);
            color: white;
        }

        .btn-success:hover {
            background-color: #229954;
        }

        .upload-section {
            background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
            padding: 2rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--accent);
        }

        .upload-section h2 {
            margin-bottom: 1.5rem;
            color: var(--accent);
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
            margin-bottom: 1rem;
        }

        .file-input-wrapper input[type=file] {
            position: absolute;
            left: -9999px;
        }

        .file-input-label {
            display: block;
            padding: 0.8rem;
            background-color: #1a1a1a;
            border: 2px dashed var(--accent);
            border-radius: 5px;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.3s;
            color: var(--text-light);
        }

        .file-input-label:hover {
            background-color: rgba(74, 158, 255, 0.1);
        }

        .preview-image {
            max-width: 300px;
            margin: 1rem 0;
            border-radius: 5px;
        }

        .photos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .photo-card {
            background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: transform 0.3s;
            border-left: 4px solid var(--accent);
        }

        .photo-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .photo-card img {
            width: 100%;
            height: 250px;
            object-fit: cover;
        }

        .photo-info {
            padding: 1rem;
        }

        .photo-info h3 {
            margin-bottom: 0.5rem;
            color: var(--text-dark);
        }

        .photo-info p {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 1rem;
        }

        .photo-actions {
            display: flex;
            gap: 0.5rem;
        }

        .photo-actions button {
            flex: 1;
            padding: 0.5rem;
            font-size: 0.9rem;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
            padding: 1.5rem;
            border-radius: 10px;
            text-align: center;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--accent);
        }

        .stat-card h3 {
            color: var(--text-light);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .stat-card .value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--accent);
        }

        .message {
            padding: 1rem;
            border-radius: 5px;
            margin-bottom: 1rem;
            display: none;
        }

        .message.show {
            display: block;
        }

        .message.success {
            background-color: rgba(40, 167, 69, 0.2);
            color: #28a745;
            border: 1px solid rgba(40, 167, 69, 0.5);
        }

        .message.error {
            background-color: rgba(220, 53, 69, 0.2);
            color: #dc3545;
            border: 1px solid rgba(220, 53, 69, 0.5);
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .admin-header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .admin-header h1 {
                font-size: 1.5rem;
            }

            .photos-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="authContainer" class="auth-container">
        <h2>üîê Login Admin</h2>
        <div class="form-group">
            <label>Username</label>
            <input type="text" id="adminUsername" placeholder="Masukkan username">
        </div>
        <div class="form-group">
            <label>Password</label>
            <input type="password" id="adminPassword" placeholder="Masukkan password">
        </div>
        <button class="btn btn-primary" onclick="handleLogin()" style="width: 100%;">Login</button>
        <p style="margin-top: 1rem; color: var(--text-light); font-size: 0.9rem;">
            </p>
    </div>

    <div id="adminPanel" class="hidden">
        <div class="admin-container">
            <div class="admin-header">
                <h1> Admin - Galeri Pribadi</h1>
                <div style="display: flex; gap: 1rem;">
                    <a href="index.html" style="padding: 0.8rem 1.5rem; background-color: #4a9eff; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; text-decoration: none; align-self: center;">‚Üê Kembali ke Galeri</a>
                    <button class="logout-btn" onclick="handleLogout()">Logout</button>
                </div>
            </div>

            <div class="stats" id="statsContainer"></div>

            <div class="message" id="message"></div>

            <!-- Edit Hero Background Section -->
            <div class="upload-section">
                <h2>Edit Background</h2>
                
                <div class="form-group">
                    <label>Pilih Gambar untuk Background</label>
                    <div class="file-input-wrapper">
                        <input type="file" id="heroBgFile" onchange="previewHeroBg()">
                        <label class="file-input-label" for="heroBgFile">
                            üìÅ Klik atau drag file gambar background di sini
                        </label>
                    </div>
                    <img id="previewHeroBg" class="preview-image hidden" style="max-height: 300px;">
                </div>

                <button id="uploadHeroBgBtn" class="btn btn-primary" type="button" style="width: 100%; display: block; margin-top: 1rem;">Update Background</button>
            </div>

            <!-- Upload Foto Section -->
            <div class="upload-section">
                <h2>üì∏ Upload Foto Baru</h2>
                
                <div class="form-group">
                    <label>Judul Foto</label>
                    <input type="text" id="photoTitle" placeholder="Berikan judul untuk foto Anda">
                </div>

                <div class="form-group">
                    <label>Deskripsi</label>
                    <textarea id="photoDescription" placeholder="Deskripsi foto (opsional)" rows="3"></textarea>
                </div>

                <div class="form-group">
                    <label>Pilih Foto</label>
                    <div class="file-input-wrapper">
                        <input type="file" id="photoFile" onchange="previewImage()">
                        <label class="file-input-label" for="photoFile">
                            üìÅ Klik atau drag file gambar di sini
                        </label>
                    </div>
                    <img id="previewImg" class="preview-image hidden">
                </div>

                <button type="button" id="uploadPhotoBtn" class="btn btn-primary" style="width: 100%; display: block; margin-top: 1rem; padding: 0.8rem 1.5rem; background-color: #4a9eff; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; transition: all 0.3s; pointer-events: auto; z-index: 100;">Upload Foto</button>
            </div>

            <!-- Photos List -->
            <div class="upload-section">
                <h2>üì∑ Foto-Foto Saya</h2>
                <div class="photos-grid" id="photosGrid">
                    <!-- Foto akan ditampilkan di sini -->
                </div>
            </div>
        </div>
    </div>

    

    <!-- Supabase client (loaded if supabase-config.js enables it) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
    <script src="supabase-config.js"></script>
    <script>
        // Firebase is disabled - using IndexedDB only (Supabase optional)
        let firestore = null;
        let storage = null;
        // Initialize Supabase client if config present
        if (window.supabaseConfigExists && window.SUPABASE_URL && window.SUPABASE_ANON_KEY) {
            try {
                window.supabase = supabase.createClient(window.SUPABASE_URL, window.SUPABASE_ANON_KEY);
                console.log('Supabase client initialized');
            } catch (e) {
                console.error('Failed to init Supabase:', e);
            }
        }

        // ===== ADMIN CREDENTIALS (Ganti dengan yang sesuai) =====
        const ADMIN_USERNAME = "admin";
        const ADMIN_PASSWORD = "admin123";
        let isLoggedIn = false;

        function handleLogin() {
            const username = document.getElementById('adminUsername').value.trim();
            const password = document.getElementById('adminPassword').value.trim();

            if (!username || !password) {
                showMessage('Username dan password harus diisi!', 'error');
                return;
            }

            if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
                isLoggedIn = true;
                localStorage.setItem('adminLoggedIn', 'true');
                document.getElementById('authContainer').classList.add('hidden');
                document.getElementById('adminPanel').classList.remove('hidden');
                loadPhotos();
                loadStats();
                showMessage('Login berhasil! üéâ', 'success');
            } else {
                showMessage('‚ùå Username atau password salah!', 'error');
            }
        }

        function handleLogout() {
            isLoggedIn = false;
            localStorage.removeItem('adminLoggedIn');
            document.getElementById('adminUsername').value = '';
            document.getElementById('adminPassword').value = '';
            document.getElementById('authContainer').classList.remove('hidden');
            document.getElementById('adminPanel').classList.add('hidden');
            showMessage('Anda telah logout', 'success');
        }

        function previewHeroBg() {
            const file = document.getElementById('heroBgFile').files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('previewHeroBg');
                    preview.src = e.target.result;
                    preview.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        }

        function uploadHeroBg() {
            if (!isLoggedIn) {
                showMessage('‚ö†Ô∏è Anda harus login terlebih dahulu!', 'error');
                return;
            }

            const file = document.getElementById('heroBgFile').files[0];

            if (!file) {
                showMessage('‚ö†Ô∏è Silakan pilih gambar background terlebih dahulu!', 'error');
                return;
            }
            showMessage('‚è≥ Mengompres background...', 'success');
            compressImage(file, async function(compressedImageUrl) {
                // Simpan ke localStorage (fallback only, no Firebase)
                localStorage.setItem('heroBgImage', compressedImageUrl);

                // Reset form
                document.getElementById('heroBgFile').value = '';
                document.getElementById('previewHeroBg').classList.add('hidden');

                showMessage('‚úÖ Background berhasil diupdate!', 'success');
            });
        }

        function previewImage() {
            const file = document.getElementById('photoFile').files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('previewImg');
                    preview.src = e.target.result;
                    preview.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        }

        function compressImage(file, callback, maxWidth = 600, quality = 0.4) {
            // Fast compression: lower quality, smaller width
            const fileSizeMB = file.size / (1024 * 1024);
            
            // Jika file sudah kecil (<500KB), langsung pakai tanpa kompresi
            if (fileSizeMB < 0.5) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    callback(e.target.result);
                };
                reader.readAsDataURL(file);
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    let width = img.width;
                    let height = img.height;

                    // Aggressive sizing down for speed
                    if (width > maxWidth) {
                        height = (height * maxWidth) / width;
                        width = maxWidth;
                    }

                    canvas.width = width;
                    canvas.height = height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    // Use lower quality and/or try webp if supported
                    canvas.toBlob(function(blob) {
                        const reader2 = new FileReader();
                        reader2.onload = function(e2) {
                            callback(e2.target.result);
                        };
                        reader2.readAsDataURL(blob);
                    }, 'image/jpeg', quality);
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function dataURLtoBlob(dataurl) {
            const arr = dataurl.split(',');
            const mime = arr[0].match(/:(.*?);/)[1];
            const bstr = atob(arr[1]);
            let n = bstr.length;
            const u8arr = new Uint8Array(n);
            while (n--) {
                u8arr[n] = bstr.charCodeAt(n);
            }
            return new Blob([u8arr], { type: mime });
        }

        // ---------- IndexedDB helper (allows storing larger images than localStorage) ----------
        function openDB() {
            return new Promise((resolve, reject) => {
                if (!window.indexedDB) return reject(new Error('IndexedDB not supported'));
                const request = indexedDB.open('galleryDB', 1);
                request.onupgradeneeded = function(e) {
                    const db = e.target.result;
                    if (!db.objectStoreNames.contains('photos')) {
                        db.createObjectStore('photos', { keyPath: 'id' });
                    }
                };
                request.onsuccess = function(e) {
                    resolve(e.target.result);
                };
                request.onerror = function(e) {
                    reject(e.target.error);
                };
            });
        }

        function savePhotoToDB(photo) {
            return openDB().then(db => new Promise((resolve, reject) => {
                const tx = db.transaction('photos', 'readwrite');
                const store = tx.objectStore('photos');
                const req = store.add(photo);
                req.onsuccess = function() { resolve(); };
                req.onerror = function(e) { reject(e.target.error); };
            }));
        }

        function getAllPhotosFromDB() {
            return openDB().then(db => new Promise((resolve, reject) => {
                const tx = db.transaction('photos', 'readonly');
                const store = tx.objectStore('photos');
                const req = store.getAll();
                req.onsuccess = function(e) { resolve(e.target.result || []); };
                req.onerror = function(e) { reject(e.target.error); };
            })).catch(() => []);
        }

        function deletePhotoFromDB(id) {
            return openDB().then(db => new Promise((resolve, reject) => {
                const tx = db.transaction('photos', 'readwrite');
                const store = tx.objectStore('photos');
                const req = store.delete(id);
                req.onsuccess = function() { resolve(); };
                req.onerror = function(e) { reject(e.target.error); };
            }));
        }

        // Upload photo (IndexedDB fallback; Supabase upload if configured)
        async function uploadPhoto() {
            console.log('uploadPhoto called, isLoggedIn:', isLoggedIn);
            console.log('Button clicked at:', new Date().toLocaleString());
            
            if (!isLoggedIn) {
                console.log('Not logged in');
                showMessage('‚ö†Ô∏è Anda harus login terlebih dahulu!', 'error');
                return;
            }

            const uploadBtn = document.getElementById('uploadPhotoBtn');
            const wasDisabled = uploadBtn.disabled;
            uploadBtn.disabled = true;
            uploadBtn.textContent = '‚è≥ Sedang mengompres...';

            try {
                const title = document.getElementById('photoTitle').value.trim() || 'Foto ' + Date.now();
                const description = document.getElementById('photoDescription').value.trim();
                const category = 'kenangan'; // Default category
                const file = document.getElementById('photoFile').files[0];

                console.log('Form data - title:', title, 'file:', file ? file.name : 'no file');

                if (!file) {
                    showMessage('‚ö†Ô∏è Pilih foto terlebih dahulu!', 'error');
                    uploadBtn.disabled = wasDisabled;
                    uploadBtn.textContent = 'Upload Foto';
                    return;
                }

                showMessage('‚è≥ Mengompres gambar...', 'success');
                compressImage(file, async function(compressedImageUrl) {
                    uploadBtn.textContent = '‚è≥ Menyimpan foto...';
                    const id = Date.now();

                    // If Supabase is configured, try uploading there first
                    if (window.supabase) {
                        try {
                            uploadBtn.textContent = '‚è≥ Mengunggah ke Supabase...';
                            const blob = dataURLtoBlob(compressedImageUrl);
                            const filename = `${Date.now()}_${Math.random().toString(36).slice(2,9)}.jpg`;
                            const { data, error: uploadErr } = await window.supabase.storage.from('gallery-photos').upload(filename, blob, { cacheControl: '3600', upsert: false });
                            if (uploadErr) throw uploadErr;

                            // Get public URL
                            const { data: publicUrlData } = window.supabase.storage.from('gallery-photos').getPublicUrl(filename);
                            const publicUrl = publicUrlData?.publicUrl || null;

                            // Insert metadata row into photos table
                            uploadBtn.textContent = '‚è≥ Menyimpan metadata...';
                            const insertPayload = {
                                title: title,
                                description: description,
                                category: category,
                                imageUrl: publicUrl || compressedImageUrl,
                                uploadDate: new Date().toISOString()
                            };
                            const { error: insertErr } = await window.supabase.from('photos').insert([insertPayload]);
                            if (insertErr) console.warn('Supabase insert error (metadata):', insertErr);

                            // Also save a local copy to IndexedDB for admin view
                            const photoData = {
                                title: title,
                                description: description,
                                category: category,
                                imageUrl: publicUrl || compressedImageUrl,
                                uploadDate: new Date().toLocaleString('id-ID'),
                                id: id
                            };
                            try { await savePhotoToDB(photoData); } catch (e) { console.warn('Local save failed:', e); }

                            // Reset form
                            document.getElementById('photoTitle').value = '';
                            document.getElementById('photoDescription').value = '';
                            document.getElementById('photoFile').value = '';
                            document.getElementById('previewImg').classList.add('hidden');

                            showMessage('‚úÖ Foto berhasil diupload ke Supabase!', 'success');
                            await loadPhotos();
                            await loadStats();
                        } catch (e) {
                            console.error('Supabase upload error:', e);
                            showMessage('‚ùå Gagal mengunggah ke Supabase. Menyimpan lokal sebagai fallback.', 'error');
                            // Fallback to local IndexedDB save below
                            try {
                                const photoData = {
                                    title: title,
                                    description: description,
                                    category: category,
                                    imageUrl: compressedImageUrl,
                                    uploadDate: new Date().toLocaleString('id-ID'),
                                    id: id
                                };
                                await savePhotoToDB(photoData);
                                document.getElementById('photoTitle').value = '';
                                document.getElementById('photoDescription').value = '';
                                document.getElementById('photoFile').value = '';
                                document.getElementById('previewImg').classList.add('hidden');
                                showMessage('‚úÖ Foto disimpan secara lokal.', 'success');
                                await loadPhotos();
                                await loadStats();
                            } catch (er) {
                                console.error('Fallback local save failed:', er);
                                showMessage('‚ùå Error menyimpan foto (fallback gagal).', 'error');
                            }
                        } finally {
                            uploadBtn.disabled = false;
                            uploadBtn.textContent = 'Upload Foto';
                        }
                        return;
                    }

                    // If Supabase not configured, save to IndexedDB only
                    const photoData = {
                        title: title,
                        description: description,
                        category: category,
                        imageUrl: compressedImageUrl,
                        uploadDate: new Date().toLocaleString('id-ID'),
                        id: id
                    };

                    try {
                        uploadBtn.textContent = '‚è≥ Menyimpan ke database...';
                        await savePhotoToDB(photoData);

                        // Reset form
                        document.getElementById('photoTitle').value = '';
                        document.getElementById('photoDescription').value = '';
                        document.getElementById('photoFile').value = '';
                        document.getElementById('previewImg').classList.add('hidden');

                        showMessage('‚úÖ Foto berhasil diupload!', 'success');
                        await loadPhotos();
                        await loadStats();
                    } catch (e) {
                        console.error('IndexedDB error:', e);
                        showMessage('‚ùå Error menyimpan foto (storage penuh?). Coba foto yang lebih kecil.', 'error');
                    } finally {
                        uploadBtn.disabled = false;
                        uploadBtn.textContent = 'Upload Foto';
                    }
                });
            } catch (e) {
                console.error('Upload error:', e);
                showMessage('‚ùå Error saat upload.', 'error');
                uploadBtn.disabled = wasDisabled;
                uploadBtn.textContent = 'Upload Foto';
            }
        }

        async function loadPhotos() {
            const photosGrid = document.getElementById('photosGrid');
            photosGrid.innerHTML = '';

            // Load from IndexedDB only
            let photos = [];
            try {
                photos = await getAllPhotosFromDB();
            } catch (e) {
                console.error('Error loading photos:', e);
                photos = [];
            }

            if (!photos || photos.length === 0) {
                photosGrid.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: #999;">Belum ada foto - upload foto pertama Anda!</p>';
                return;
            }

            photos.forEach((photo, index) => {
                const photoCard = document.createElement('div');
                photoCard.className = 'photo-card';
                photoCard.innerHTML = `
                    <img src="${photo.imageUrl}" alt="${photo.title}">
                    <div class="photo-info">
                        <h3>${photo.title}</h3>
                        <p>${photo.description || 'Tanpa deskripsi'}</p>
                        <small>${photo.uploadDate}</small>
                        <div class="photo-actions" style="margin-top: 0.5rem;">
                            <button class="btn btn-danger" onclick="deletePhoto(${photo.id})">Hapus</button>
                        </div>
                    </div>
                `;
                photosGrid.appendChild(photoCard);
            });
        }

        async function deletePhoto(photoId) {
            if (!confirm('Apakah Anda yakin ingin menghapus foto ini?')) return;

            // Delete from IndexedDB only
            try {
                await deletePhotoFromDB(photoId);
                await loadPhotos();
                await loadStats();
                showMessage('üóëÔ∏è Foto berhasil dihapus!', 'success');
            } catch (e) {
                console.error('Delete error:', e);
                showMessage('‚ùå Gagal menghapus foto.', 'error');
            }
        }

        async function loadStats() {
            const photos = await getAllPhotosFromDB();
            const statsContainer = document.getElementById('statsContainer');
            statsContainer.innerHTML = `
                <div class="stat-card">
                    <h3>üìä Total Foto</h3>
                    <div class="value">${photos.length}</div>
                </div>
            `;
        }

        function showMessage(text, type) {
            const messageEl = document.getElementById('message');
            messageEl.textContent = text;
            messageEl.className = `message show ${type}`;
            setTimeout(() => {
                messageEl.classList.remove('show');
            }, 4000);
        }

        // Auto-login jika sudah pernah login sebelumnya
            window.addEventListener('load', async function() {
            console.log('Page loaded');
            const wasLoggedIn = localStorage.getItem('adminLoggedIn') === 'true';
            if (wasLoggedIn) {
                isLoggedIn = true;
                document.getElementById('authContainer').classList.add('hidden');
                document.getElementById('adminPanel').classList.remove('hidden');
                    await loadPhotos();
            }
            await loadStats();
            
            // Attach event listeners to buttons
            setTimeout(function() {
                const uploadPhotoBtn = document.getElementById('uploadPhotoBtn');
                console.log('Upload photo btn found:', !!uploadPhotoBtn);
                if (uploadPhotoBtn) {
                    uploadPhotoBtn.addEventListener('click', function(e) {
                        console.log('Button clicked via addEventListener');
                        e.preventDefault();
                        e.stopPropagation();
                        uploadPhoto();
                    });
                    console.log('Upload photo button listener attached successfully');
                }
            }, 100);
            
            const uploadHeroBgBtn = document.getElementById('uploadHeroBgBtn');
            if (uploadHeroBgBtn) {
                uploadHeroBgBtn.addEventListener('click', uploadHeroBg);
                console.log('Upload hero bg button listener attached');
            }
        });
    </script>
</body>
</html>
